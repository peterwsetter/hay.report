---
title: Template
author: ''
date: '2018-12-29'
slug: template
categories: []
tags: []
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(dplyr)
library(tidyr)
library(ggplot2)

load('../data/report_data.rds')

report_data %>% 
    filter(between(report_date, CURRENT_DATE - 14, CURRENT_DATE)) ->
  datathisweek


CURRENT_DATE <- as.Date('2018-12-22')
CURRENT_WEEK <- lubridate::week(CURRENT_DATE)
```


## Premium Squares

```{r pls, fig.height=4.5}
report_data %>% 
  filter(report_week == CURRENT_WEEK,
         forage == 'Alfalfa',
         shape == 'Squares',
         quality == 'Premium',
         !is.na(price_low)) %>% 
  mutate(price_high = ifelse(is.na(price_high), price_low, price_high)) %>% 
  group_by(state, forage, shape, size) %>% 
  summarize(price_min = min(price_low),
            price_max = max(price_high),
            price_avg = mean(price_avg)) %>% 
  ggplot(aes(x = state, y = price_avg, 
            ymin = price_min, ymax = price_max,
            label = paste0('$',round(price_avg))
            )
         ) +
  geom_pointrange() +
  geom_text(vjust = 1.5) +
  theme_bw() +
  labs(x = 'State',
        y = 'Price') +
  facet_wrap(~size, ncol = 1) +
  coord_flip()

```

